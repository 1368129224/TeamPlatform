{% extends 'iframe_base.html' %}

{% block content %}
    <h1>资产审核</h1>
    <br>
    <table class="table">
        <thead>
        <tr>
            <th scope="col">姓名</th>
            <th scope="col">学号</th>
            <th scope="col">状态</th>
            <th scope="col">操作</th>
        </tr>
        </thead>
        <tbody>
        {% for asset in assets.items %}
            <tr>
                <td style="vertical-align: middle;">{{ asset.asset_name }}</td>
                <td style="vertical-align: middle;">{{ asset.user.username }}</td>
                <td style="vertical-align: middle;">
                    {% if asset.status == '0' %}
                        <p style="margin: 0;">待审核</p>
                    {% elif asset.status == '1' %}
                        <p style="margin: 0;{% if asset.end_time < now %}color: red;{% endif %}">已通过</p>
                    {% elif asset.status == '2' %}
                        <p style="margin: 0;">已归还</p>
                    {% endif %}
                </td>
                <td>
                    <button class="btn btn-light {% if asset.status == '1' %}disabled{% elif asset.status == '2' %}disabled{% endif %}" onclick="change_status({{ asset.id }}, '1')" {% if asset.status == '1' %}disabled{% elif asset.status == '2' %}disabled{% endif %}>通过</button>
                    <button class="btn btn-light {% if asset.status == '0' %}disabled{% elif asset.status == '2' %}disabled{% endif %}" onclick="change_status({{ asset.id }}, '2')" {% if asset.status == '0' %}disabled{% elif asset.status == '2' %}disabled{% endif %}>结束</button>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if assets.has_prev %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('lab.verify_asset', page=assets.prev_num) }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <a class="page-link" href="#" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            {% endif %}
            {% if assets.has_next %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('lab.verify_asset', page=assets.next_num) }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <a class="page-link" href="#" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
{% endblock %}

{% block js %}
    {{ JSGlue.include() }}
    <script>
        function change_status(asset_id, status) {
            $.post(Flask.url_for('lab.deliver_asset'), JSON.stringify({'asset_id': asset_id, 'status': status}), function (data) {
                if (data==='true')
                {
                    alert('修改成功');
                    window.location.reload();
                }
            })
        }
    </script>
{% endblock %}
